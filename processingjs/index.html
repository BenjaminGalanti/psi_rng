<!DOCTYPE html>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<html>
<head>
  <title>Hello Web - Processing.js Test</title>
  <script src="processing-1.4.1.min.js"></script>
<script>
document.onreadystatechange = function () {
  if (document.readyState == "complete") {
    window.WebSocket = window.WebSocket || window.MozWebSocket;
    var socket = new WebSocket('ws://psi.chickenkiller.com:8080', 'rng-protocol');
    socket.binaryType = "arraybuffer";
    var first_time = true;
    socket.onmessage = function (message) {
      var numbers = new Uint8Array(message.data);
      if(first_time){
        console.log("number recieved : ", numbers);
        first_time = false;
      }
      var app = Processing.getInstanceById('sketch');
      if(app != null){
        for(var i = 0 ; i < numbers.length ; i++){
          //Simulate serial event for processingjs app
          app.serialEvent(numbers[i]);
        }
      }
    }

    socket.onopen = function(){
      console.log("Connection open");
    }
/*
    var viewFullScreen = document.getElementById("sketch");
    if (viewFullScreen) {
        viewFullScreen.addEventListener("click", function () {
            var docElm = document.documentElement;
            if (docElm.requestFullscreen) {
                docElm.requestFullscreen();
            }
            else if (docElm.mozRequestFullScreen) {
                docElm.mozRequestFullScreen();
            }
            else if (docElm.webkitRequestFullScreen) {
                docElm.webkitRequestFullScreen();
            }
        }, false);
    }*/
  }
}
</script>
<style>
canvas {
  margin:  0px;
  padding: 0px;
}
</style>
</head>
<body>
  <!--canvas id="sketch" data-processing-sources="random_graph.pjs"></canvas-->
  <center><canvas id="sketch" data-processing-sources="robot_hazard.pjs tychoscope.pjs rng.pjs"></canvas></center>
</body>
</html>

